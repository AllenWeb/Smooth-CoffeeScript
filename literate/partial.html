<!DOCTYPE html>
<html manifest="pandoc-template.appcache">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="date" content="☕" />
  <title>Partial with Free Variables — Smooth CoffeeScript</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
/*<![CDATA[*/
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre 
   { margin: 0; padding: 0; border: 0; vertical-align: baseline; border: none; }
td.lineNumbers { border-right: 1px solid #AAAAAA; text-align: right; color: #AAAAAA; padding-right: 5px; padding-left: 5px; }
td.sourceCode { padding-left: 5px; }
code.sourceCode span.kw { color: #007020; font-weight: bold; } 
code.sourceCode span.dt { color: #902000; }
code.sourceCode span.dv { color: #40a070; }
code.sourceCode span.bn { color: #40a070; }
code.sourceCode span.fl { color: #40a070; }
code.sourceCode span.ch { color: #4070a0; }
code.sourceCode span.st { color: #4070a0; }
code.sourceCode span.co { color: #60a0b0; font-style: italic; }
code.sourceCode span.ot { color: #007020; }
code.sourceCode span.al { color: red; font-weight: bold; }
code.sourceCode span.fu { color: #06287e; }
code.sourceCode span.re { }
code.sourceCode span.er { color: red; font-weight: bold; }
/*]]>*/
  </style>
  <link rel="stylesheet" href="pandoc-template.css" />
</head>
<body>
<div class="rdbWrapper" data-show-read="1" data-show-send-to-kindle="1" data-show-print="1" data-show-email="1" data-orientation="0" data-version="1" data-bg-color="#fffce6"></div><script type="text/javascript">(function() {var s = document.getElementsByTagName("script")[0],rdb = document.createElement("script"); rdb.type = "text/javascript"; rdb.async = true; rdb.src = document.location.protocol + "//www.readability.com/embed.js"; s.parentNode.insertBefore(rdb, s); })();</script>
<div id="feature-detect">
  <div id="feature-javascript" style="color:#FF0000; display: block">
No JavaScript &rarr; no output and no interactivity.  </div>
  <div id="feature-mathml" style="color:#FF0000; display: none">
No MathML 1998 &rarr; math is not readable.  </div>
  <div id="feature-canvas" style="color:#FF0000; display: none">
No Canvas &rarr; graphical output is not rendered.  </div>
  <div id="feature-contenteditable" style="color:#FF0000; display: none">
No ContentEditable &rarr; CoffeeScript sections can not be changed.  </div>
</div>
<input class="field" type="button" value="Adjust layout" onclick="(function () {
        return this.value = toggleLayout() ? 'Allow freeflow' : 'Use fixed width';
      }).call(this);" />
<script src="node_modules/coffee-script.js"></script>
<script src="node_modules/coffeekup.js"></script>
<script src="node_modules/underscore.js"></script>
<script src="node_modules/underscore.string.js"></script>
<script src="node_modules/qc.js"></script>
<script>var __slice = Array.prototype.slice;var __hasProp = Object.prototype.hasOwnProperty;var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };var __extends = function(child, parent) {  for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; }  function ctor() { this.constructor = child; }  ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype;  return child; };var __indexOf = Array.prototype.indexOf || function(item) {  for (var i = 0, l = this.length; i < l; i++) {    if (this[i] === item) return i;  } return -1; };(function () {
      var featureDetect, switchLayout;
      this.reveal = function(parent) {
        return parent.getElementsByTagName('code')[0].style.display = 'block';
      };
      this.toggleLayout = function() {
        var fixedLayout;
        fixedLayout = document.getElementById('page').style.maxWidth === '';
        if (typeof localStorage !== "undefined" && localStorage !== null) {
          localStorage.fixedLayout = fixedLayout;
        }
        return switchLayout(fixedLayout);
      };
      switchLayout = function(fixedLayout) {
        var s;
        document.getElementById('page').style.maxWidth = fixedLayout ? '600px' : '';
        s = document.getElementById('page').style;
        if (fixedLayout) {
          s.webkitHyphens = 'auto';
          s.mozHyphens = 'auto';
          s.msHyphens = 'auto';
          s.hyphens = 'auto';
          s.textAlign = 'justify';
        } else {
          s.webkitHyphens = '';
          s.mozHyphens = '';
          s.msHyphens = '';
          s.hyphens = '';
          s.textAlign = '';
        }
        return fixedLayout;
      };
      featureDetect = function() {
        var mathmlDetect, used, _ref, _ref2, _ref3, _ref4;
        mathmlDetect = function() {
          var e, passed;
          (e = document.createElement('div')).innerHTML = '<math></math>';
          passed = e.firstChild && 'namespaceURI' in e.firstChild && e.firstChild.namespaceURI === 'http://www.w3.org/1998/Math/MathML';
          return passed && !/Chrome/.test(navigator.userAgent);
        };
        if ((_ref = document.getElementById('feature-javascript')) != null) {
          _ref.style.display = "none";
        }
        used = (document.getElementsByTagName('math')) != null;
        if (used && mathmlDetect() === false) {
          if ((_ref2 = document.getElementById('feature-mathml')) != null) {
            _ref2.style.display = "block";
          }
        }
        if (document.createElement('canvas').getContext == null) {
          if ((_ref3 = document.getElementById('feature-canvas')) != null) {
            _ref3.style.display = "block";
          }
        }
        if (!('isContentEditable' in document.documentElement)) {
          return (_ref4 = document.getElementById('feature-contenteditable')) != null ? _ref4.style.display = "block" : void 0;
        }
      };
      window.onload = function() {
        var canvas, delayedEvaluation, evaluateSource, segment, _i, _len, _ref;
        featureDetect();
        if ((typeof localStorage !== "undefined" && localStorage !== null ? localStorage.fixedLayout : void 0) !== 'false') {
          switchLayout(true);
        }
        canvas = document.getElementById('drawCanvas');
        if (canvas != null) window.ctx = canvas.getContext('2d');
        evaluateSource = function() {
          var HtmlListener, addElement, addErrorElement, addFrame, code, codeSegment, codeTag, draw, elem, getParent, i, qcConfig, segment, segments, separator, show, showDocument, test, testPure, _i, _len, _len2;
          if (window.ctx != null) {
            window.ctx.clearRect(0, 0, window.ctx.canvas.width, window.ctx.canvas.height);
          }
          getParent = function(child) {
            var _ref;
            return (_ref = child != null ? child.parentElement : void 0) != null ? _ref : child != null ? child.parentNode : void 0;
          };
          elem = window.document.getElementsByClassName('output')[0];
          while (elem != null) {
            getParent(elem).removeChild(elem);
            elem = window.document.getElementsByClassName('output')[0];
          }
          addElement = function(parent, text) {
            var newelem;
            newelem = document.createElement('code');
            newelem.setAttribute('class', 'sourceCode output');
            newelem.innerHTML = text;
            return parent.appendChild(newelem);
          };
          separator = function(parent) {
            if (parent.getElementsByClassName('output').length === 0) {
              return addElement(parent, '<hr><br>');
            }
          };
          addErrorElement = function(text) {
            var parentTag;
            parentTag = getParent(codeTag);
            separator(parentTag);
            return addElement(parentTag, "<span class=\"er\">" + text + "</span>");
          };
          show = function(msg) {
            var parentTag;
            parentTag = getParent(codeTag);
            separator(parentTag);
            addElement(parentTag, "&rarr; " + msg + "<br>");
            return msg;
          };
          addFrame = function(parent, width, height, content) {
            var newelem;
            newelem = document.createElement('iframe');
            newelem.setAttribute('class', 'output');
            newelem.setAttribute('width', width);
            newelem.setAttribute('height', height);
            newelem.setAttribute('src', "data:text/html;charset=utf-8," + (encodeURIComponent(content)));
            newelem.innerHTML = '<div id="feature-dataurl" style="color:#FF0000; display: block">\nNo or insufficient Data URL support &rarr;\nweb page output is not rendered in this browser.</div>';
            return parent.appendChild(newelem);
          };
          showDocument = function(content, width, height) {
            var parentTag;
            if (width == null) width = 300;
            if (height == null) height = 300;
            parentTag = getParent(codeTag);
            separator(parentTag);
            return addFrame(parentTag, width, height, content);
          };
          HtmlListener = (function(_super) {

            __extends(HtmlListener, _super);

            function HtmlListener(maxCollected) {
              this.maxCollected = maxCollected != null ? maxCollected : 10;
            }

            HtmlListener.prototype.log = function(str) {
              return show(str);
            };

            HtmlListener.prototype.passed = function(str) {
              return show("<span class=\"kw\">" + str + "</span>");
            };

            HtmlListener.prototype.invalid = function(str) {
              return show("<span class=\"dt\">" + str + "</span>");
            };

            HtmlListener.prototype.failure = function(str) {
              return show("<span class=\"al\">" + str + "</span>");
            };

            HtmlListener.prototype.done = function() {
              show('Completed test.');
              return resetProps();
            };

            return HtmlListener;

          })(ConsoleListener);
          Case.prototype.note = function(a) {
            this.noteArg(a);
            return a;
          };
          Case.prototype.noteVerbose = function(a) {
            this.noteArg(a);
            show(this.args);
            return a;
          };
          testPure = function(func, types, name, property) {
            return declare(name, types, function() {
              var a, c;
              c = arguments[0], a = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
              return c.assert(property.apply(null, [c].concat(__slice.call(a), [c.note(func.apply(null, a))])));
            });
          };
          qcConfig = new Config(100, 1000);
          test = function(msg, func) {
            return _.each([msg, func, runAllProps(qcConfig, new HtmlListener)], function(o) {
              if (!_.isUndefined(o)) return show(o);
            });
          };
          segments = (function() {
            var _i, _len, _ref, _results;
            _ref = document.getElementsByTagName('pre');
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              codeSegment = _ref[_i];
              if (codeSegment.className === 'sourceCode') {
                codeTag = codeSegment.getElementsByTagName('code')[0];
                if (codeTag.className === 'sourceCode coffeescript' || codeTag.className === 'sourceCode CoffeeScript') {
                  segment = codeTag.innerHTML;
                  code = segment.replace(/<br>/g, '\n');
                  code = code.replace(/<[^>]*>/g, '');
                  code = code.replace(/[&]gt;/g, '>');
                  code = code.replace(/[&]lt;/g, '<');
                  code = code.replace(/[&]nbsp;/g, ' ');
                  _results.push({
                    codeTag: codeTag,
                    code: code
                  });
                } else {
                  _results.push(void 0);
                }
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          })();
          segments = (function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = segments.length; _i < _len; _i++) {
              segment = segments[_i];
              if (segment != null) _results.push(segment);
            }
            return _results;
          })();
          for (i = 0, _len = segments.length; i < _len; i++) {
            segment = segments[i];
            if (i > 0 && /^[\s]/.test(segment.code)) {
              segment.code = segments[i - 1].code + '\n' + segment.code;
              segments[i - 1] = void 0;
            }
          }
          segments = (function() {
            var _i, _len2, _results;
            _results = [];
            for (_i = 0, _len2 = segments.length; _i < _len2; _i++) {
              segment = segments[_i];
              if (segment != null) _results.push(segment);
            }
            return _results;
          })();
          for (_i = 0, _len2 = segments.length; _i < _len2; _i++) {
            segment = segments[_i];
            codeTag = segment.codeTag;
            try {
              draw = void 0;
              eval(CoffeeScript.compile(segment.code, {
                bare: true
              }));
              if (draw != null) draw(window.ctx);
            } catch (error) {
              addErrorElement(error);
              return;
            }
          }
        };
        delayedEvaluation = _.throttle(evaluateSource, 100);
        _ref = document.getElementsByTagName('pre');
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          segment = _ref[_i];
          segment.getElementsByTagName('code')[0].addEventListener('keyup', delayedEvaluation, false);
          segment.getElementsByTagName('code')[0].addEventListener('focus', (function() {
            return this.innerHTML = this.innerHTML.toString().replace(/<span[^>]*>/g, '');
          }), false);
        }
        return evaluateSource();
      };
      return window.ostrich = 'data:image/png;base64,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';
    }).call(this);</script>

<div id="page">
<header>
<h1 class="title">Partial with Free Variables — <em><a href="http://autotelicum.github.com/Smooth-CoffeeScript/">Smooth CoffeeScript</a></em></h1>
<h4 class="date">☕</h4>
</header>
<blockquote>
<p>This literate program is <em>interactive</em> in its HTML<sub>5</sub> form. Edit a CoffeeScript segment to try it. You can see the generated JavaScript as you modify a CoffeeScript function by typing ‘show name’ after its definition.</p>
</blockquote>
<h2 id="partial-function-application-with-free-variables">Partial function application with free variables</h2>
<p>Partial function application is presented in <a href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-partial-application-0">Smooth CoffeeScript partial application</a>. It is a way to create a function from another function where the first arguments are filled in. With the new function we can then ignore those arguments so subsequent calls become easier to read and write.</p>
<p>It is not always the case that arguments are so nicely ordered that it is the first ones that need to be held constant. To handle the general case with arbitrary arguments, a special symbol<sup><a href="#fn1" class="footnoteRef" id="fnref1">1</a></sup> can designate free variables i.e. those arguments that are not fixed.</p>
<p>In the code below<sup><a href="#fn2" class="footnoteRef" id="fnref2">2</a></sup> the <code>movement</code> function is inspired by the canvas function <code>bezierCurveTo</code>. It takes nine arguments, clearly outdoing <code>bezierCurveTo</code>’s measly six arguments. When calling such a function from many places, several of the arguments may well be the same.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">draw <span class="kw">=</span> <span class="fu">(ctx) -&gt;</span> <span class="co"># Try changing colors below</span><br />  ctx<span class="kw">.</span>beginPath<span class="kw">();</span> ctx<span class="kw">.</span>strokeStyle <span class="kw">=</span> <span class="st">'gold'</span><br />  drawMove ctx<span class="kw">,</span> <span class="kw">(</span>ix <span class="kw">for</span> ix <span class="kw">in</span> <span class="kw">[</span><span class="dv">0</span><span class="kw">...</span><span class="dv">90</span><span class="kw">]</span> <span class="kw">by</span> <span class="dv">10</span><span class="kw">)</span><br />  ctx<span class="kw">.</span>beginPath<span class="kw">();</span> ctx<span class="kw">.</span>strokeStyle <span class="kw">=</span> <span class="st">'salmon'</span><br />  drawPath ctx<span class="kw">,</span> <span class="kw">(</span>ix <span class="kw">for</span> ix <span class="kw">in</span> <span class="kw">[</span><span class="dv">0</span><span class="kw">...</span><span class="dv">90</span><span class="kw">]</span> <span class="kw">by</span> <span class="dv">10</span><span class="kw">)</span><br /><br />movement <span class="kw">=</span> <span class="fu">(ctx, ax, ay, cp1x, cp1y, cp2x, cp2y, x, y) -&gt;</span><br />  ctx<span class="kw">.</span>moveTo ax<span class="kw">,</span> ay<br />  ctx<span class="kw">.</span>bezierCurveTo cp1x<span class="kw">,</span> cp1y<span class="kw">,</span> cp2x<span class="kw">,</span> cp2y<span class="kw">,</span> x<span class="kw">,</span> y<br /><br />drawMove <span class="kw">=</span> <span class="fu">(ctx, args) -&gt;</span><br />  args<span class="kw">.</span>forEach <span class="fu">(ix) -&gt;</span> movement ctx<span class="kw">,</span><br />    <span class="dv">0</span><span class="kw">,</span> <span class="dv">0</span><span class="kw">,</span> <span class="dv">30</span><span class="kw">,</span> <span class="dv">30</span><span class="kw">,</span> <span class="dv">150</span><span class="kw">+</span>ix<span class="kw">,</span> <span class="dv">50</span><span class="kw">,</span> <span class="dv">110</span><span class="kw">+</span>ix<span class="kw">,</span> <span class="dv">90</span><br />  ctx<span class="kw">.</span>stroke<span class="kw">()</span></code></pre>
<p><canvas id="drawCanvas" width="200" height="100"></canvas> </p>
<p>A wrapper function <code>swirl</code> that takes only those arguments that might change can cut down on the repetition. The <code>partialFree</code> function returns a new function when given a function, its fixed arguments and the placeholder symbol for the variable arguments.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false"><br />_ <span class="kw">=</span> <span class="ot">undefined</span><br />partialFree <span class="kw">=</span> <span class="fu">(func, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span><br />  func <span class="kw">(</span><span class="kw">for</span> arg <span class="kw">in</span> a <span class="kw">then</span> arg <span class="kw">?=</span> b<span class="kw">.</span>shift<span class="kw">())...</span><br /><br />swirl <span class="kw">=</span> partialFree movement<span class="kw">,</span> _<span class="kw">,</span> _<span class="kw">,</span> <span class="dv">0</span><span class="kw">,</span> <span class="dv">30</span><span class="kw">,</span> <span class="dv">30</span><span class="kw">,</span> _<span class="kw">,</span> <span class="dv">50</span><span class="kw">,</span> _<span class="kw">,</span> <span class="dv">90</span><br /><br />drawPath <span class="kw">=</span> <span class="fu">(ctx, args) -&gt;</span><br />  args<span class="kw">.</span>forEach <span class="fu">(ix) -&gt;</span> swirl ctx<span class="kw">,</span> <span class="dv">200</span><span class="kw">,</span> <span class="dv">150</span><span class="kw">+</span>ix<span class="kw">,</span> <span class="dv">110</span><span class="kw">+</span>ix<br />  ctx<span class="kw">.</span>stroke<span class="kw">()</span></code></pre>
<h2 id="prior-art">Prior Art</h2>
<p>Where did the definition of <code>partialFree</code> come from? It started with a <a href="http://duckduckgo.com/?q=Partial%20function%20application">search</a> for existing implementations. The search eventually turned up this JavaScript version from <a href="http://javascriptweblog.wordpress.com/2010/05/17/partial-currys-flashy-cousin/">Angus Croll’s blog</a>.</p>
<pre class="sourceCode"><code class="sourceCode javascript"><span class="kw">window</span>.___ = {}; <span class="co">//argument placeholder</span><br /><br /><span class="kw">Function</span>.<span class="fu">prototype</span>.<span class="fu">partial</span> = <span class="kw">function</span>() {<br />    <span class="kw">if</span> (<span class="kw">arguments</span>.<span class="fu">length</span>&lt;<span class="dv">1</span>) {<br />        <span class="co">//nothing to pre-assign - return the function as is</span><br />        <span class="kw">return</span> <span class="kw">this</span>;<br />    }<br />    <span class="kw">var</span> __method = <span class="kw">this</span>;<br />    <span class="kw">var</span> args = arguments;<br />    <span class="kw">return</span> <span class="kw">function</span>() {<br />        <span class="co">//build up new arg list, for placeholders use current arg,</span><br />        <span class="co">//otherwise copy original args</span><br />        <span class="kw">var</span> argIndex = <span class="dv">0</span>, myArgs = [];<br />        <span class="kw">for</span> (<span class="kw">var</span> i = <span class="dv">0</span>; i &lt; <span class="kw">args</span>.<span class="fu">length</span>; i++) {<br />            myArgs[i] = <span class="kw">window</span>.___==args[i] ?<br />                arguments[argIndex++] : args[i];<br />        }<br />        <span class="kw">return</span> <span class="kw">__method</span>.<span class="fu">apply</span>(<span class="kw">this</span>, myArgs);<br />    }<br />}</code></pre>
<p>And this CoffeeScript version from <a href="http://blog.mirotin.net/8/15-lines-long-partial-function-application-with-coffeescript-js">Mirotin</a>.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="kw">{}</span><br />partial15lines <span class="kw">=</span> <span class="fu">() -&gt;</span><br />  <span class="kw">[</span>func<span class="kw">,</span> args<span class="kw">...]</span> <span class="kw">=</span> arguments<br />  wrapper <span class="kw">=</span> <span class="fu">() -&gt;</span><br />    i <span class="kw">=</span> <span class="dv">0</span><br />    j <span class="kw">=</span> <span class="dv">0</span><br />    res_args <span class="kw">=</span> <span class="kw">[]</span><br />    <span class="kw">while</span> i <span class="kw">&lt;</span> args<span class="kw">.</span>length<br />      <span class="kw">if</span> args<span class="kw">[</span>i<span class="kw">]</span> <span class="kw">==</span> _<br />        res_args<span class="kw">.</span>push arguments<span class="kw">[</span>j<span class="kw">]</span><br />        j<span class="kw">++</span><br />      <span class="kw">else</span><br />        res_args<span class="kw">.</span>push args<span class="kw">[</span>i<span class="kw">]</span><br />      i<span class="kw">++</span><br />    <span class="kw">return</span> func<span class="kw">.</span>apply <span class="ot">null</span><span class="kw">,</span> res_args</code></pre>
<h2 id="stepwise-coffeescript-improvements">Stepwise CoffeeScript Improvements</h2>
<p>Those implementations are fine and usable as they are. But here comes one of the most fun activities in CoffeeScript: <em>code reduction</em>. It is also useful because less code makes maintenance easier — up to a point — too clever tricks and the code can become harder to understand. In the following line of code reductions, which one would you choose as the best balance between brevity and readability?</p>
<p>In <code>partial15lines</code> there are some redundant words that can be removed. The use of <a href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-arguments-0">arguments</a> can also be replaced with a splat <code>...</code></p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="kw">{}</span><br />partial12lines <span class="kw">=</span> <span class="fu">(func, args...) -&gt;</span><br />  <span class="fu">(moreargs...) -&gt;</span><br />    i <span class="kw">=</span> j <span class="kw">=</span> <span class="dv">0</span><br />    res_args <span class="kw">=</span> <span class="kw">[]</span><br />    <span class="kw">while</span> i <span class="kw">&lt;</span> args<span class="kw">.</span>length<br />      <span class="kw">if</span> args<span class="kw">[</span>i<span class="kw">]</span> <span class="kw">==</span> _<br />        res_args<span class="kw">.</span>push moreargs<span class="kw">[</span>j<span class="kw">++]</span><br />      <span class="kw">else</span><br />        res_args<span class="kw">.</span>push args<span class="kw">[</span>i<span class="kw">]</span><br />      i<span class="kw">++</span><br />    func<span class="kw">.</span>apply <span class="ot">null</span><span class="kw">,</span> res_args</code></pre>
<p>In CoffeeScript <code>while</code> is an expression that returns the value of its inner block, so there is no need for pushing values to a results array.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="kw">{}</span><br />partial10lines <span class="kw">=</span> <span class="fu">(func, args...) -&gt;</span><br />  <span class="fu">(moreargs...) -&gt;</span><br />    i <span class="kw">=</span> j <span class="kw">=</span> <span class="dv">0</span><br />    func<span class="kw">.</span>apply <span class="ot">null</span><span class="kw">,</span><br />      <span class="kw">while</span> i<span class="kw">++</span> <span class="kw">&lt;</span> args<span class="kw">.</span>length<br />        <span class="kw">if</span> args<span class="kw">[</span>i<span class="dv">-1</span><span class="kw">]</span> <span class="kw">==</span> _<br />          moreargs<span class="kw">[</span>j<span class="kw">++]</span><br />        <span class="kw">else</span><br />          args<span class="kw">[</span>i<span class="dv">-1</span><span class="kw">]</span></code></pre>
<p>A <code>for</code> loop instead of the <code>while</code> gets rid of the <code>length</code> check. A splat can also be used in a call which eliminates the <code>apply</code>. The old school <code>==</code> can be replaced with <code>is</code>.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="kw">{}</span><br />partial8lines <span class="kw">=</span> <span class="fu">(func, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span><br />  i <span class="kw">=</span> <span class="dv">0</span><br />  func <span class="kw">(</span><span class="kw">for</span> arg <span class="kw">in</span> a<br />    <span class="kw">if</span> arg <span class="kw">is</span> _<br />      b<span class="kw">[</span>i<span class="kw">++]</span><br />    <span class="kw">else</span><br />      arg<span class="kw">)...</span></code></pre>
<p>The low level counter <code>i</code> is only used to get the next argument from <code>b</code>. The same effect can be achieved by treating <code>b</code> as a LIFO (Last In First Out) buffer. To do that <code>b</code> has to be reversed.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="kw">{}</span><br />partial5lines <span class="kw">=</span> <span class="fu">(func, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span><br />  b<span class="kw">.</span>reverse<span class="kw">()</span><br />  func <span class="kw">(</span><span class="kw">for</span> arg <span class="kw">in</span> a<br />    <span class="kw">if</span> arg <span class="kw">is</span> _ <span class="kw">then</span> b<span class="kw">.</span>pop<span class="kw">()</span> <span class="kw">else</span> arg<span class="kw">)...</span></code></pre>
<p>Instead of using an empty object as the placeholder, using <code>undefined</code> allows the <code>if</code> test to be replaced with an <a href="http://autotelicum.github.com/Smooth-CoffeeScript/SmoothCoffeeScript.html#entry-existential-operator-0">existential assignment</a> <code>?=</code>.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="ot">undefined</span><br />partial4lines <span class="kw">=</span> <span class="fu">(func, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span><br />  b<span class="kw">.</span>reverse<span class="kw">()</span><br />  func <span class="kw">(</span><span class="kw">for</span> arg <span class="kw">in</span> a <span class="kw">then</span> arg <span class="kw">?=</span> b<span class="kw">.</span>pop<span class="kw">())...</span></code></pre>
<p>Reversing the <code>b...</code> arguments are only required because <code>pop</code> returns the last element. Noé Rubinstein joined the <em>code reduction</em> fun by noticing that the <code>Array::shift</code> function removes and returns the first argument.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">_ <span class="kw">=</span> <span class="ot">undefined</span><br />partial3lines <span class="kw">=</span> <span class="fu">(func, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span><br />  func <span class="kw">(</span><span class="kw">for</span> arg <span class="kw">in</span> a <span class="kw">then</span> arg <span class="kw">?=</span> b<span class="kw">.</span>shift<span class="kw">())...</span></code></pre>
<h2 id="test">Test</h2>
<p>A couple of test cases and an example of <code>partial</code>. In the interactive HTML<sub>5</sub> you can try substituting the number in <code>partial3lines</code> to test the other versions.</p>
<pre class="sourceCode"><code class="sourceCode coffeescript" contenteditable="true" spellcheck="false">test <span class="kw">=</span> <span class="fu">-&gt;</span><br />  f <span class="kw">=</span> <span class="fu">(x, y, z) -&gt;</span> x <span class="kw">+</span> <span class="dv">2</span><span class="kw">*</span>y <span class="kw">+</span> <span class="dv">5</span><span class="kw">*</span>z<br />  g <span class="kw">=</span> partialFree f<span class="kw">,</span> _<span class="kw">,</span> <span class="dv">1</span><span class="kw">,</span> _<br />  show <span class="st">&quot;g 3, 5 =&gt; </span><span class="ch">#{</span>g 3, 5<span class="ch">}</span><span class="st"> Expected: 30&quot;</span><br /><br />  <span class="co"># Modified from an alexkg example</span><br />  fold <span class="kw">=</span> <span class="fu">(f, z, xs) -&gt;</span><br />    z <span class="kw">=</span> f<span class="kw">(</span>z<span class="kw">,</span> x<span class="kw">)</span> <span class="kw">for</span> x <span class="kw">in</span> xs<br />    z<br />  max <span class="kw">=</span> partialFree fold<span class="kw">,</span> <span class="ot">Math</span><span class="kw">.</span>max<span class="kw">,</span> <span class="kw">-</span><span class="ot">Infinity</span><span class="kw">,</span> _<br />  show <span class="st">&quot;max [-10..10] =&gt; </span><span class="ch">#{</span>max [-10..10]<span class="ch">}</span><span class="st"> Expected: 10&quot;</span><br /><br />  <span class="co"># Without free vars</span><br />  partial <span class="kw">=</span> <span class="fu">(f, a...) -&gt;</span> <span class="fu">(b...) -&gt;</span> f a<span class="kw">...,</span> b<span class="kw">...</span><br />  min <span class="kw">=</span> partial fold<span class="kw">,</span> <span class="ot">Math</span><span class="kw">.</span>min<span class="kw">,</span> <span class="ot">Infinity</span><br />  show <span class="st">&quot;min [-10..10] =&gt; </span><span class="ch">#{</span>min [-10..10]<span class="ch">}</span><span class="st"> Expected: -10&quot;</span><br />partialFree <span class="kw">=</span> partial3lines<br />test<span class="kw">()</span></code></pre>
<hr />
<p> </p>
<p> </p>
<p></p>
<p>Formats <a href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/partial.coffee">CoffeeScript</a> <a href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/partial.md">Markdown</a> <a href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/partial.pdf">PDF</a> <a href="http://autotelicum.github.com/Smooth-CoffeeScript/literate/partial.html">HTML</a></p>
<p>License <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a> by autotelicum © 2554/2011</p>
<!--
Commands used to extract code, execute it, and to format this document:

Edit ,x/^~~+[   ]*{\.[cC]offee[sS]cript.*}$/+,/^~~+$/-p
Edit ,>ssam -n 'x/^~~+[   ]*{\.[cC]offee[sS]cript.*}$/+,/^~~+$/-' |cat embed-standalone.coffee - |tee partial.coffee | coffee -cs >partial.js; coffee partial.coffee >partial.output; plumb partial.output
Edit ,>pandoc -f markdown -t html -S -5 --mathml --css pandoc-template.css --template pandoc-template.html -B embed-readability.html -B embed-literate.html | ssam 's/(<code class="sourceCode coffeescript" contenteditable="true" spellcheck="false")/\1 contenteditable=\"true\" spellcheck=\"false\"/g' | ssam 's/(<pre class="sourceCode")><(code class="sourceCode CoffeeScript")/\1 onclick=\"reveal(this)\" ><b><u>Solution<\/u><\/b><br\/><\2 contenteditable=\"true\" spellcheck=\"false\" style=\"display:none\" \"/g' | ssam 's/<img src=\"[^\"]+\" alt=\"[^\"]+\" \/>/<canvas id=\"drawCanvas\" width=\"200\" height=\"100\"><\/canvas>/' >partial.html; open partial.html; plumb partial.html
Edit ,>markdown2pdf --listings --xetex '--template=pandoc-template.tex' -o partial.pdf; open partial.pdf

To execute these commands; middle-button select them in the acme environment.
acme and ssam are part of the plan9 OS and can run on *nix variants via plan9port.
The formatting is done with pandoc, a universal markup converter, and TeX.
-->


<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In the examples underscore <code>_</code> is used. You may want to choose another symbol to avoid clashes with commonly used libraries such as <a href="http://documentcloud.github.com/underscore/">Underscore</a>. <a href="#fnref1" class="footnoteBackLink">↩</a></p></li>
<li id="fn2"><p>To run this example standalone you can prepend this <a href="http://coffeekup.org/">CoffeeKup</a> CoffeeScript:</p>
<pre><code>show = if exports? then console.log else alert
(require 'fs').writeFileSync &quot;./bezier.html&quot;,
  webpage = (require 'coffeekup').render -&gt; 
    doctype 5
    html -&gt; meta charset: 'utf-8',
      head -&gt; title 'Bezier path'
      body -&gt; 
        canvas id: 'drawCanvas', width: 300, height: 200
        coffeescript -&gt;
          window.onload = -&gt;
            canvas = document.getElementById 'drawCanvas'
            ctx = canvas.getContext '2d'
            alert 'No canvas in this browser.' unless ctx?
            draw ctx if draw?
</code></pre>
 <a href="#fnref2" class="footnoteBackLink">↩</a></li>
</ol>
</div>
</body>
</html>